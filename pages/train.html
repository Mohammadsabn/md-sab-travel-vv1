<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Train Booking - JourneyEase</title>
    
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Define Custom Colors for Tailwind (Primary: Indigo) -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Custom primary color (matching indigo-600)
                        'primary': '#4f46e5', 
                        'primary-hover': '#4338ca',
                    },
                }
            }
        }
    </script>

    <!-- Load Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7fa;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .search-card {
            margin-top: 4rem;
        }

        /* Basic CSS for smooth view transitions */
        .view {
            opacity: 0;
            transition: opacity 0.5s ease;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
        }
        .view.active {
            opacity: 1;
            position: relative;
            display: block;
        }
        
        /* Utility for the ticket download button animation */
        .download-button:hover .fa-download {
            transform: translateY(-2px);
            transition: transform 0.2s ease-in-out;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="bg-white shadow-lg sticky top-0 z-20 border-b border-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Top Row: Logo, Desktop Nav, Mobile Toggle Button -->
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-train text-primary text-3xl"></i>
                    <h1 class="text-3xl font-extrabold text-gray-800">Journey<span class="text-primary">Ease</span></h1>
                </div>

                <!-- DESKTOP Navigation (Visible on MD and larger) -->
                <nav id="desktop-nav" class="hidden md:flex space-x-6 items-end">
                    <!-- Linking back to index.html to simulate multi-page navigation -->
                    <a href="../index.html" class="tab px-2 py-1 text-gray-600 hover:text-primary flex items-center transition duration-150"><i class="fas fa-plane mr-2"></i>Flights</a>
                    <!-- Active Tab -->
                    <a href="train.html" class="tab px-2 py-1 text-primary font-bold flex items-center border-b-2 border-primary transition duration-150"><i class="fas fa-train mr-2"></i>Trains</a>
                    <!-- Other Tabs -->
                    <a href="bus.html" class="tab px-2 py-1 text-gray-600 hover:text-primary flex items-center transition duration-150"><i class="fas fa-bus-alt mr-2"></i>Buses</a>
                    <a href="hotel.html" class="tab px-2 py-1 text-gray-600 hover:text-primary flex items-center transition duration-150"><i class="fas fa-hotel mr-2"></i>Hotels</a>
                    <a href="cabs.html" class="tab px-2 py-1 text-gray-600 hover:text-primary flex items-center transition duration-150"><i class="fas fa-taxi mr-2"></i>Cabs</a>
                </nav>
                
                <!-- MOBILE Menu Toggle Button (Hidden on MD and larger) -->
                <button id="menu-toggle" class="md:hidden p-2 text-gray-600 hover:text-primary transition" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars text-2xl"></i>
                </button>
            </div>

            <!-- MOBILE Navigation Links (Toggled via JS, Hidden on MD and larger) -->
            <div id="mobile-menu" class="hidden md:hidden pt-2 pb-4 border-t border-gray-100">
                <nav class="flex flex-col space-y-1">
                    <a href="../index.html" class="block py-2 px-3 text-gray-600 hover:bg-indigo-50 hover:text-primary rounded-lg transition duration-150"><i class="fas fa-plane mr-2"></i>Flights</a>
                    <a href="train.html" class="block py-2 px-3 text-primary font-bold bg-indigo-50 border-r-4 border-primary rounded-lg transition duration-150"><i class="fas fa-train mr-2"></i>Trains</a>
                    <a href="bus.html" class="block py-2 px-3 text-gray-600 hover:bg-indigo-50 hover:text-primary rounded-lg transition duration-150"><i class="fas fa-bus-alt mr-2"></i>Buses</a>
                    <a href="hotel.html" class="block py-2 px-3 text-gray-600 hover:bg-indigo-50 hover:text-primary rounded-lg transition duration-150"><i class="fas fa-hotel mr-2"></i>Hotels</a>
                    <a href="cabs.html" class="block py-2 px-3 text-gray-600 hover:bg-indigo-50 hover:text-primary rounded-lg transition duration-150"><i class="fas fa-taxi mr-2"></i>Cabs</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content Wrapper: This holds all the switchable views -->
    <main class="flex-grow max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8 py-12 relative">
        
        <!-- ==================================================================== -->
        <!-- 1. SEARCH VIEW (Initial Screen) -->
        <!-- ==================================================================== -->
        <div id="search-view" class="view active">
            <div class="bg-white p-6 md:p-8 rounded-xl search-card shadow-2xl shadow-indigo-100/50 relative z-0">
                <h2 class="text-2xl md:text-3xl font-extrabold text-gray-800 mb-6">Search for Trains</h2>
                
                <form id="train-search-form" onsubmit="handleTrainSearch(event)" class="space-y-6">
                    <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
                        
                        <!-- From -->
                        <div>
                            <label for="from" class="block text-sm font-medium text-gray-700 mb-1"><i class="fas fa-map-marker-alt text-red-500 mr-1"></i> From</label>
                            <input type="text" id="from" name="from" value="New Delhi" placeholder="Origin Station" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary transition duration-150" required>
                        </div>

                        <!-- To -->
                        <div>
                            <label for="to" class="block text-sm font-medium text-gray-700 mb-1"><i class="fas fa-map-marker-alt text-green-500 mr-1"></i> To</label>
                            <input type="text" id="to" name="to" value="Mumbai" placeholder="Destination Station" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary transition duration-150" required>
                        </div>

                        <!-- Departure Date -->
                        <div>
                            <label for="departure_date" class="block text-sm font-medium text-gray-700 mb-1"><i class="fas fa-calendar-alt text-indigo-500 mr-1"></i> Departure</label>
                            <input type="date" id="departure_date" name="departure_date" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary transition duration-150" required>
                        </div>

                    </div>

                    <!-- Passengers -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="passengers" class="block text-sm font-medium text-gray-700 mb-1"><i class="fas fa-users text-teal-500 mr-1"></i> Passengers</label>
                            <!-- NOTE: Changed default value to 2 to better showcase dynamic forms -->
                            <select id="passengers" name="passengers" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary transition duration-150 bg-white">
                                <option value="1">1 Adult</option>
                                <option value="2" selected>2 Adults</option> 
                                <option value="3">3 Adults</option>
                                <option value="4">4 Adults</option>
                            </select>
                        </div>
                    </div>

                    <!-- Search Button -->
                    <div class="text-center pt-4">
                        <button type="submit" class="w-full sm:w-1/2 lg:w-1/3 py-4 px-6 bg-primary text-white font-bold text-lg rounded-full hover:bg-primary-hover transition duration-300 shadow-xl shadow-indigo-400/50 flex items-center justify-center mx-auto transform hover:scale-[1.01]">
                            <i class="fas fa-search mr-2"></i> Search Trains
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ==================================================================== -->
        <!-- 2. RESULTS VIEW (Select Train) -->
        <!-- ==================================================================== -->
        <div id="results-view" class="view">
            <h2 class="text-3xl font-extrabold text-gray-800 mb-6">Available Trains <span id="route-display" class="text-primary text-xl font-semibold ml-2"></span></h2>
            <div class="bg-white p-6 rounded-xl shadow-2xl shadow-indigo-100/50 space-y-4">
                
                <!-- Back Button -->
                <button onclick="switchView('search-view')" class="text-sm font-medium text-primary hover:text-primary-hover transition mb-4 flex items-center">
                    <i class="fas fa-arrow-left mr-2"></i> Back to Search
                </button>

                <!-- Sample Train Result 1 -->
                <div class="border border-gray-200 rounded-xl p-4 flex flex-col md:flex-row justify-between items-start md:items-center hover:shadow-lg transition duration-200">
                    <div class="flex-grow">
                        <p class="text-xl font-bold text-gray-800">Duronto Express (12222)</p>
                        <p class="text-sm text-gray-500">Departure: 14:30 | Arrival: 06:15 (+1 day)</p>
                        <p class="text-lg font-semibold text-teal-600 mt-1">Price per person: <span class="text-gray-800 font-bold">₹ 4,500</span> | Available: AC-First Class, Sleeper</p>
                    </div>
                    <div class="text-right mt-3 md:mt-0">
                        <button onclick="handleSelectTrain('Duronto Express', '4500')" class="mt-2 py-2 px-6 bg-primary text-white font-medium rounded-lg hover:bg-primary-hover transition duration-200 shadow-md flex items-center justify-center">
                            <i class="fas fa-plus mr-2"></i> Book & Add Passengers
                        </button>
                    </div>
                </div>

                <!-- Sample Train Result 2 -->
                <div class="border border-gray-200 rounded-xl p-4 flex flex-col md:flex-row justify-between items-start md:items-center hover:shadow-lg transition duration-200">
                    <div class="flex-grow">
                        <p class="text-xl font-bold text-gray-800">Rajdhani Superfast (12952)</p>
                        <p class="text-sm text-gray-500">Departure: 17:00 | Arrival: 10:45 (+1 day)</p>
                        <p class="text-lg font-semibold text-teal-600 mt-1">Price per person: <span class="text-gray-800 font-bold">₹ 3,200</span> | Available: AC-3 Tier, Sleeper</p>
                    </div>
                    <div class="text-right mt-3 md:mt-0">
                        <button onclick="handleSelectTrain('Rajdhani Superfast', '3200')" class="mt-2 py-2 px-6 bg-primary text-white font-medium rounded-lg hover:bg-primary-hover transition duration-200 shadow-md flex items-center justify-center">
                             <i class="fas fa-plus mr-2"></i> Book & Add Passengers
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================================================================== -->
        <!-- 3. PASSENGER VIEW (Enter Passenger Details) -->
        <!-- ==================================================================== -->
        <div id="passenger-view" class="view">
            <h2 class="text-3xl font-extrabold text-gray-800 mb-2">Passenger Details</h2>
            <p class="text-lg text-gray-600 mb-6">
                Booking: <span id="train-name-display" class="font-bold text-primary"></span> 
                (<span class="font-bold text-primary">₹ <span id="train-price-per-person"></span> per person</span>)
            </p>

            <div class="bg-white p-6 rounded-xl shadow-2xl shadow-indigo-100/50">
                <button onclick="switchView('results-view')" class="text-sm font-medium text-primary hover:text-primary-hover transition mb-4 flex items-center">
                    <i class="fas fa-arrow-left mr-2"></i> Change Train
                </button>
                
                <form id="passenger-form" onsubmit="handlePassengerForm(event)" class="space-y-6">
                    
                    <!-- Dynamic Passenger Forms Container -->
                    <div id="passenger-forms-container" class="space-y-4">
                        <!-- Forms will be injected here by JavaScript -->
                    </div>

                    <!-- Contact Details -->
                    <h3 class="font-bold text-xl text-gray-800 pt-4 border-t mt-6">Contact Information</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" id="email" value="jane@example.com" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary" required>
                        </div>
                        <div>
                            <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                            <input type="tel" id="phone" value="+1234567890" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary" required>
                        </div>
                    </div>

                    <!-- Proceed Button -->
                    <div class="text-center pt-6">
                        <button type="submit" class="w-full md:w-1/3 py-3 px-6 bg-primary text-white font-bold text-lg rounded-full hover:bg-primary-hover transition duration-300 shadow-xl">
                            <i class="fas fa-credit-card mr-2"></i> Proceed to Pay
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ==================================================================== -->
        <!-- 4. PAYMENT VIEW (Simplified Payment Gateway) -->
        <!-- ==================================================================== -->
        <div id="payment-view" class="view">
            <h2 class="text-3xl font-extrabold text-gray-800 mb-6">Complete Payment</h2>
            
            <div class="bg-white p-6 md:p-10 rounded-xl shadow-2xl shadow-indigo-100/50 max-w-lg mx-auto">
                <p class="text-2xl font-bold text-red-600 mb-4">Total Amount: <span id="final-price-display" class="text-3xl"></span></p>
                <p class="text-sm text-gray-600 mb-6">Includes base fare, taxes, and service fees for <span id="num-passengers-display" class="font-semibold text-primary"></span> travelers.</p>
                
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6" role="alert">
                    <p class="font-medium text-yellow-700">Payment Gateway Simulation</p>
                    <p class="text-sm text-yellow-700">No real transaction will occur. Click 'Pay Now' to confirm booking.</p>
                </div>

                <div class="space-y-4">
                    <!-- Placeholder Card Details -->
                    <div>
                        <label for="card-number" class="block text-sm font-medium text-gray-700 mb-1">Card Number</label>
                        <input type="text" id="card-number" value="1234 5678 9012 3456" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                    </div>
                    <div class="grid grid-cols-3 gap-4">
                        <div>
                            <label for="expiry" class="block text-sm font-medium text-gray-700 mb-1">Expiry</label>
                            <input type="text" id="expiry" value="12/26" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                        </div>
                        <div class="col-span-2">
                            <label for="cvv" class="block text-sm font-medium text-gray-700 mb-1">CVV</label>
                            <input type="text" id="cvv" value="123" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                        </div>
                    </div>
                </div>

                <!-- Pay Button -->
                <div class="text-center pt-8">
                    <button onclick="handlePayment()" class="w-full py-3 px-6 bg-primary text-white font-bold text-lg rounded-full hover:bg-primary-hover transition duration-300 shadow-xl">
                        <i class="fas fa-lock mr-2"></i> Pay Now
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ==================================================================== -->
        <!-- 5. CONFIRMATION VIEW (Success and Download) -->
        <!-- ==================================================================== -->
        <div id="confirmation-view" class="view">
            <div class="bg-white p-8 md:p-12 rounded-xl shadow-2xl shadow-green-200/50 text-center max-w-xl mx-auto">
                <i class="fas fa-check-circle text-green-500 text-6xl mb-4"></i>
                <h2 class="text-4xl font-extrabold text-gray-800 mb-2">Booking Confirmed!</h2>
                <p class="text-xl text-gray-600 mb-6">Your e-ticket has been successfully processed.</p>
                
                <div class="bg-green-50 p-4 rounded-lg border border-green-200 mb-8 text-left">
                    <p class="text-md text-green-800 font-semibold mb-1">Booking ID: <span class="font-bold">TRN-4720912</span></p>
                    <p class="text-sm text-green-700">Train: <span id="final-train-name" class="font-medium"></span></p>
                    <p class="text-sm text-green-700">Route: <span id="final-route-display" class="font-medium"></span></p>
                    <p class="text-lg text-green-800 font-bold mt-2 border-t pt-2">Total Paid: <span id="final-price-confirmation"></span></p>
                </div>

                <!-- Download Button -->
                <button onclick="downloadTicketPdf()" class="download-button w-full py-3 px-6 bg-primary text-white font-bold text-lg rounded-full hover:bg-primary-hover transition duration-300 shadow-xl flex items-center justify-center">
                    <i class="fas fa-download mr-3 transition duration-200"></i> Download E-Ticket (PDF)
                </button>

                <!-- Start New Search -->
                <button onclick="switchView('search-view')" class="mt-4 text-primary hover:text-primary-hover transition font-medium">
                    <i class="fas fa-plus mr-1"></i> Start a New Search
                </button>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center text-sm text-gray-500">
            &copy; <span id="current-year-footer"></span> JourneyEase Demo. All rights reserved.
        </div>
    </footer>

    <!-- Simple Message Box (Required by JS functions) -->
    <div id="message-box" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div class="bg-white p-6 rounded-lg shadow-2xl text-center max-w-xs">
            <p id="message-content" class="text-gray-800 font-semibold mb-4"></p>
            <button onclick="hideMessageBox()" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-hover transition">OK</button>
        </div>
    </div>

    <script>
        // Global state to store booking details across views
        let bookingDetails = {
            from: '',
            to: '',
            date: '',
            passengers: 0,
            trainName: '',
            price: 0, // Price per person
            totalPrice: 0,
            passengersData: []
        };
        
        // --- NEW: Mobile Menu State ---
        let isMobileMenuOpen = false;

        // Initialize the year in the footer
        document.getElementById('current-year-footer').textContent = new Date().getFullYear();

        // --- CORE VIEW SWITCHING LOGIC ---

        /**
         * Switches the active content view by setting the 'active' class.
         * @param {string} viewId - The ID of the view div to show (e.g., 'results-view').
         */
        function switchView(viewId) {
            const views = document.querySelectorAll('.view');
            views.forEach(view => {
                view.classList.remove('active');
            });
            const targetView = document.getElementById(viewId);
            if (targetView) {
                targetView.classList.add('active');
                window.scrollTo(0, 0); // Scroll to top for new view
            }
            // Close mobile menu if open when navigating to a new view
            if (isMobileMenuOpen) {
                toggleMobileMenu(); 
            }
        }
        
        // --- NEW: Mobile Menu Toggle Function ---
        /**
         * Toggles the visibility and content of the mobile navigation menu.
         */
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobile-menu');
            const menuIcon = document.querySelector('#menu-toggle i');

            isMobileMenuOpen = !isMobileMenuOpen;

            if (isMobileMenuOpen) {
                mobileMenu.classList.remove('hidden');
                // Change icon to 'X'
                menuIcon.classList.remove('fa-bars');
                menuIcon.classList.add('fa-times');
            } else {
                mobileMenu.classList.add('hidden');
                // Change icon back to 'Hamburger'
                menuIcon.classList.remove('fa-times');
                menuIcon.classList.add('fa-bars');
            }
        }


        // --- STEP 1: SEARCH VIEW HANDLER ---
        function handleTrainSearch(event) {
            event.preventDefault(); 
            
            const from = document.getElementById('from').value;
            const to = document.getElementById('to').value;
            const date = document.getElementById('departure_date').value;
            const passengers = document.getElementById('passengers').value;

            if (!from || !to || !date) {
                showMessageBox("Please fill out all required fields.");
                return;
            }

            // Store search data globally
            bookingDetails.from = from;
            bookingDetails.to = to;
            bookingDetails.date = date;
            bookingDetails.passengers = parseInt(passengers); // Store as integer

            // Update route display on the results page
            document.getElementById('route-display').textContent = 
                `${from} to ${to} on ${date}`;

            // Go to Step 2: Results View
            switchView('search-view'); // Show search first, then results
            setTimeout(() => switchView('results-view'), 100); // Small delay to ensure smooth transition
        }

        // --- STEP 2: RESULTS VIEW HANDLER (Select Train) ---
        function handleSelectTrain(trainName, price) {
            // Store selected train details globally
            bookingDetails.trainName = trainName;
            bookingDetails.price = parseFloat(price); // Price per person

            // Update details on the passenger form page
            document.getElementById('train-name-display').textContent = trainName;
            document.getElementById('train-price-per-person').textContent = price;

            // Render the required number of passenger forms
            renderPassengerForms();

            // Go to Step 3: Passenger View
            switchView('passenger-view');
        }

        // --- Dynamic Form Rendering ---
        function renderPassengerForms() {
            const container = document.getElementById('passenger-forms-container');
            container.innerHTML = ''; // Clear existing forms
            const numPassengers = bookingDetails.passengers || 1; // Default to 1 if missing

            for (let i = 1; i <= numPassengers; i++) {
                // Pre-fill primary passenger (i=1) with example data
                const defaultName = i === 1 ? 'Jane Doe' : `Traveler ${i}`;
                const defaultAge = i === 1 ? 30 : (25 + i);

                const passengerHtml = `
                    <div class="border p-4 rounded-xl bg-indigo-50 shadow-md">
                        <h3 class="font-bold text-xl text-indigo-700 mb-4">Passenger ${i} ${i === 1 ? '(Primary Traveler)' : `(Adult ${i})`}</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="p${i}-name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                                <input type="text" id="p${i}-name" name="p${i}-name" value="${defaultName}" class="passenger-input w-full p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary" required>
                            </div>
                            <div>
                                <label for="p${i}-age" class="block text-sm font-medium text-gray-700 mb-1">Age</label>
                                <input type="number" id="p${i}-age" name="p${i}-age" value="${defaultAge}" min="1" max="100" class="passenger-input w-full p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary" required>
                            </div>
                            <div>
                                <label for="p${i}-gender" class="block text-sm font-medium text-gray-700 mb-1">Gender</label>
                                <select id="p${i}-gender" name="p${i}-gender" class="passenger-input w-full p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary bg-white" required>
                                    <option value="Female" ${i === 1 ? 'selected' : ''}>Female</option>
                                    <option value="Male">Male</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', passengerHtml);
            }
        }

        // --- STEP 3: PASSENGER VIEW HANDLER ---
        function handlePassengerForm(event) {
            event.preventDefault();

            // Simple validation check for all dynamically generated passenger fields
            const requiredInputs = document.querySelectorAll('.passenger-input');
            let allFilled = true;
            requiredInputs.forEach(input => {
                if (!input.value) {
                    allFilled = false;
                }
            });

            if (!allFilled || !document.getElementById('email').value || !document.getElementById('phone').value) {
                showMessageBox("Please ensure ALL passenger and contact details are filled correctly.");
                return;
            }

            // Calculate total price and update state
            bookingDetails.totalPrice = bookingDetails.price * bookingDetails.passengers;

            // Update price displays
            document.getElementById('final-price-display').textContent = `₹ ${bookingDetails.totalPrice.toFixed(2)}`;
            document.getElementById('num-passengers-display').textContent = `${bookingDetails.passengers} adult${bookingDetails.passengers > 1 ? 's' : ''}`;

            // Go to Step 4: Payment View
            switchView('payment-view');
        }

        // --- STEP 4: PAYMENT VIEW HANDLER ---
        function handlePayment() {
            showMessageBox("Processing your payment. Please wait...");
            
            // Wait a moment before switching to confirmation
            setTimeout(() => {
                hideMessageBox();
                
                // Update final confirmation details
                document.getElementById('final-train-name').textContent = bookingDetails.trainName;
                document.getElementById('final-route-display').textContent = `${bookingDetails.from} to ${bookingDetails.to}`;
                document.getElementById('final-price-confirmation').textContent = `₹ ${bookingDetails.totalPrice.toFixed(2)}`;

                // Go to Step 5: Confirmation View
                switchView('confirmation-view');
            }, 1500); // 1.5 second delay for dramatic effect
        }

        // --- STEP 5: CONFIRMATION VIEW HANDLER (Download PDF) ---
        function downloadTicketPdf() {
            // Collect passenger data for the file content
            const passengersList = [];
            for (let i = 1; i <= bookingDetails.passengers; i++) {
                passengersList.push(
                    `Passenger ${i}: ${document.getElementById(`p${i}-name`).value} (Age: ${document.getElementById(`p${i}-age`).value}, Gender: ${document.getElementById(`p${i}-gender`).value})`
                );
            }

            const ticketInfo = `
=============================================
              E-TICKET CONFIRMATION
=============================================
Booking ID: TRN-4720912
Train: ${bookingDetails.trainName}
Route: ${bookingDetails.from} to ${bookingDetails.to}
Departure Date: ${bookingDetails.date}
Total Paid: ₹ ${bookingDetails.totalPrice.toFixed(2)}

---------------------------------------------
PASSENGER DETAILS (${bookingDetails.passengers} Travelers)
---------------------------------------------
${passengersList.join('\n')}

---------------------------------------------
CONTACT DETAILS
---------------------------------------------
Email: ${document.getElementById('email').value}
Phone: ${document.getElementById('phone').value}

=============================================
This is a simulated ticket for demonstration.
Thank you for booking with JourneyEase!
=============================================
`;
            // Simple text file download simulation for PDF
            const blob = new Blob([ticketInfo], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Train_Ticket_${bookingDetails.trainName.replace(/\s/g, '_')}.txt`; // Use .txt since it's not a real PDF
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showMessageBox("E-Ticket simulated download complete!");
        }


        // --- UTILITY: MESSAGE BOX ---
        
        /**
         * Shows a custom message box instead of using the forbidden alert().
         * @param {string} message - The message to display.
         */
        function showMessageBox(message) {
            document.getElementById('message-content').textContent = message;
            document.getElementById('message-box').classList.remove('hidden');
            document.getElementById('message-box').classList.add('flex');
        }

        /**
         * Hides the custom message box.
         */
        function hideMessageBox() {
            document.getElementById('message-box').classList.add('hidden');
            document.getElementById('message-box').classList.remove('flex');
        }
    </script>
</body>
</html>
